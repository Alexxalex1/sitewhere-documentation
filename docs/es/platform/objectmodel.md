# Domain Object Model

<Seo/>

SiteWhere includes a comprehensive object model which contains
a hierarchy of entities intended to represent real-world objects
that interact with IoT applications. Many of the concepts remain
fairly generic so that a variety of potential vertical markets may
be represented by the same model.

## Entity Identification

Most SiteWhere entities have two separate unique identifiers. The
primary identifier is a [UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier)
which is assigned by the system when the entity is created and
does not change over the lifetime of the entity. A second identifier,
which is unique within the entity type, is a _token_ which is a
string assigned via the APIs and updated at any time. This approach
allows the token for an entity to change over time if needed
without the need to update the identifier in relations that reference
the entity. All API operations act on the entity token, while all
internal references between entities use the internal UUID.

## Device Management Model

One of the primary functions of an IoT platform is to represent
the devices that the platform interacts with. SiteWhere provides
a comprehensive model for capturing information about the devices
managed by the system and for organizing them so that context is
provided around the data generated by the devices.

### Device Types

The platform may interact with many types of devices, each with its own
characteristics. These include aspects such as device hardware, configuration
options, status indicators, and available commands. SiteWhere _device types_
are used to capture information about a class of devices with
similar characteristics.

::: tip
SiteWhere 2.0 _device types_ correspond to SiteWhere 1.x
_device specifications_. All of the features from the previous
model remain in 2.0.
:::

#### Device Commands

Each device type may contain a list of commands that are accepted by
the device. The commands are identified by a namespace and unique
name, along with a list of strongly-typed, named parameters.
External actors may issue device command invocation events which
in turn communicate with devices to transmit a command payload
to the device.

#### Device Statuses

Each device type may have many potential status values that reflect
the internal state of a device. A device status contains information
such as a unique code, icon, display text, and color information that
may be used to render the status indicator in applications that use
the SiteWhere APIs.

### Devices

Devices represent real-world instances of a device type that may
interact with the system. Each device has a unique _device token_
which is used when registering, updating, or associating data with
the device.

### Device Assignments

Devices may be associated with various entities over their lifetime in
order to provide context for the device at a given point of time. The entity
that captures these associations is called a _device assignment_. Examples
of device assignment associations include customer ownership, geospatial
location, and association with various assets. A device assignment is
effective for a given amount of time while it is considered _active_ and
may be marked as _released_ when no longer in effect. The list of device
assignments over time provide a historical record for the device. Associations
from the current device assignment are stored with device events in order
to provide context when querying the event data.

### Customer Associations

The concept of a customer is used to infer ownership of a device.
A given device may be assigned to many different customers over its lifetime.
When events are recorded for a device, the events include a reference
to the customer assigned to the device at the time of the event.

#### Customer Types

Customer types are used to group related types of customers. They are
hierarchical in nature, so customer types may be parents or children of
other customer types. For example, in the construction vertical, the
customer type hierarchy might be **Division** > **Municipality** > **Site**.
Extra metadata and branding information may be attached to each customer type in order
to provide more context.

#### Customers

Customers are instances of customer types which represent real-world entites
that reflect ownership of devices. Each customer may have a parent customer
and any number of child customers based on the hierarchy established in the
customer types. An example of customers based on the customer type hierarchy
above would be **Commercial Division** > **Atlanta** > **777 Peachtree Site**.

### Area Associations

The concept of an area is used to establish geospatial context for a device.
A given device may be assigned to many areas over its lifetime. When events
are recorded for a device, they include a reference to the area assigned to
the device at the time of the event.

::: tip
SiteWhere 2.0 _areas_ correspond to SiteWhere 1.x _sites_. Most of the features
from the previous model remain in 2.0, but areas now define a bounding polygon
rather than just the central lat/long used in 1.x.
:::

#### Area Types

Area types provide context for areas and are arranged in a parent-child
hierarchy. In general, parent area types are intended to be containers for
the child types. For instance, in a hotel vertical, the area type hierarchy
might be **Region** > **Hotel** > **Floor** > **Room**. Extra metadata and
branding information may be attached to each area type in order to provide
more context.

#### Areas

Areas are instances of areas types which represent real-world geospatial
locations that provide context for devices. An area has a bounding polygon
of lat/longs which defines the borders of the entity. An example of areas
that conform to the area type hierarchy above would be **Southeast Region** >
**Mariott Marquis** > **Floor 20** > **Room 2001**.

#### Zones

Zones are bounded geospatial entities which have areas as parents. An area may
contain any number of zones, which are used to signify a portion of the area
that has particular significance. For instance, if modeling an airport as an
area, restricted access sections could be marked as zones. When processing events
from a device located in the airport, alert events might be generated when
entering restricted zones. Along with the bounding lat/longs for a zone, a
background color, border color, and opacity are stored so that zones may be
rendered on top of maps or floorplans dynamically based on the stored metadata.

## Asset Management Model

Devices are often deployed in association with real-world assets which derive
some service from the device. Use cases include:

- a tracking device associated with an automobile in the fleet-tracking vertical
- a badge associated with a person in the security vertical
- a heart monitor associated with a bed in a healthcare veritcal

SiteWhere provides an asset management model for storing assets that may be
associated with system devices. External asset management systems may be
provided based on the same set of APIs in cases where assets need to be
managed externally.

### Asset Types

Asset types represent a class of assets that may be used in the system. These
generally correspond to entries in a product catalog and would be identified
with a SKU rather than a serial number. Asset types capture common metadata
for assets such as weight, dimensions, or other facets that apply across all
assets of the type.

### Assets

Assets are instances of asset types and generally correspond to real-world
entites that might have a unique serial number. Assets may be associated with
one or more devices based on device assignments and these assignments may
change over time. The device assignment history reflects the list of associated
assets over time. For instance, a temporary security badge that is associated
with person assets will have a history of every person the badge was assigned
to. All events for the badge would also be tied to the assignments and could
be filtered based on the person the badge was assigned to.

## Event Management Model

The event management model is used to capture temporal events related to
devices. This includes telemetry data and device state changes as well as
audit data such as command invocations and responses. Device events are
stored as time-series data and are generally persisted separately from
device management data due to their temporal nature and large scale
relative to the "master" data.

All device events share common fields such as the date the event
occurred, the date the event was received, the id of the device,
the current device assignment and various associations which
may be used to filter/aggregate event data. In addition, each device
event subtype contains extra data specific to its function.

### Measurement Events

Measurement events contain a measurement name and a measurement value and
are used to capture telemetry data from devices. Examples include:

- Fuel readings from heavy equipment on a contruction site
- Heart rate for a heart monitor in a healthcare facility
- Speed recorded for a vehicle in a fleet-tracking application

### Location Events

Location events track location (latitude/longitude/elevation) for a device
at a specific point in time. Location events may be used in conjunction
with areas and zones to perform logic in response to a device entering/exiting
established boundaries.

### Alert Events

Alert events indicate that an exceptional condition has occurred. An alert
includes an alert type, message, alert level, and other information that
provides context as to the condition that occurred. Alerts may be used to
trigger other system actions based on business logic added to the event
processing pipeline.

### Command Invocation Events

Each time a command is invoked via the SiteWhere APIs, a command invocation
event is recorded. The event processing pipeline passes the event into the
command delivery microservice, which handles packaging the command in the
correct format and delivering the command to the target device. Command
invocation events also provide an audit trail of commands issued along with
how they were invoked and who invoked them.

### Command Response Events

When commands are sent to devices, there are cases where the device
sends data in response to the command. In cases where an originating
event id is sent along with other event data, the event is recorded
as a command response so the response may be correlated back to the
event that originated it. This allows for tracking whether commands
have been received in cases where an acknowledgement is required.

### State Change Events

State change events are used to convey changes to internal device state
as well as other system-level state changes such as presence detection
updates. Devices may send state change events for cases such as going
into sleep mode or detection of a low battery state.
